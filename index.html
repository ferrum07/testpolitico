<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Afinidad Pol√≠tica Espa√±a</title>
    <meta name="description" content="Test interactivo para evaluar tu afinidad con los principales partidos pol√≠ticos de Espa√±a">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        
        /* Estilos de transici√≥n */
        .slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-option {
            transition: all 0.2s;
        }
        .btn-option:active {
            transform: scale(0.99);
        }

        /* Colores Espec√≠ficos */
        .bg-sumar { background-color: #E51C55; }
        .text-sumar { color: #E51C55; }
        
        .bg-psoe { background-color: #E30613; }
        .text-psoe { color: #E30613; }
        
        .bg-pp { background-color: #0056A3; }
        .text-pp { color: #0056A3; }
        
        .bg-vox { background-color: #63BE21; }
        .text-vox { color: #63BE21; }

        /* Estilos de Im√°genes */
        .party-logo-main {
            height: 160px;
            width: auto;
            object-fit: contain;
            display: block;
            margin: 0 auto;
        }
        .party-logo-small {
            height: 24px;
            width: 24px;
            object-fit: contain;
            margin-right: 8px;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Contenedor Principal -->
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden min-h-[600px] flex flex-col relative border border-gray-100">
        
        <!-- Header -->
        <header class="bg-slate-800 text-white p-6 text-center shadow-md">
            <h1 class="text-2xl font-bold tracking-tight">Br√∫jula Electoral</h1>
            <p class="text-slate-300 text-sm mt-1">An√°lisis de posicionamiento pol√≠tico en 30 cuestiones</p>
        </header>

        <!-- Pantalla de Inicio -->
        <div id="start-screen" class="flex-1 flex flex-col items-center justify-center p-8 text-center space-y-6">
            <div class="text-6xl mb-2" role="img" aria-label="Urna electoral">üó≥Ô∏è</div>
            <h2 class="text-xl font-semibold text-gray-800">Test de Afinidad Pol√≠tica</h2>
            <p class="text-gray-600 max-w-md">Este cuestionario compara tus respuestas con los programas electorales oficiales de los principales partidos.</p>
            
            <div class="text-xs text-gray-500 bg-gray-50 p-3 rounded border border-gray-200">
                <strong>Nota:</strong> Las opciones se presentan desordenadas aleatoriamente.
            </div>

            <button id="start-button" class="px-8 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                Iniciar Cuestionario
            </button>
        </div>

        <!-- Pantalla de Preguntas -->
        <div id="quiz-screen" class="hidden flex-1 flex flex-col p-6">
            <!-- Barra de progreso -->
            <div class="w-full bg-gray-100 rounded-full h-2 mb-8" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            
            <div class="flex-1 flex flex-col justify-center">
                <div class="mb-4">
                    <span id="question-number" class="text-xs font-bold text-blue-600 uppercase tracking-wider bg-blue-50 px-2 py-1 rounded">Pregunta 1/30</span>
                </div>
                
                <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-snug">
                    <!-- Pregunta insertada por JS -->
                </h2>

                <div id="options-container" class="space-y-3" role="group" aria-label="Opciones de respuesta">
                    <!-- Opciones insertadas por JS -->
                </div>
            </div>
        </div>

        <!-- Pantalla de Resultados -->
        <div id="result-screen" class="hidden flex-1 flex flex-col p-6 slide-in overflow-y-auto max-h-[90vh]">
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-2">An√°lisis de Resultados</h2>
            <p class="text-center text-gray-500 mb-6 text-sm">Tu mayor afinidad es con:</p>

            <!-- Contenedor del Ganador -->
            <div id="winner-container" class="text-center mb-8 p-8 bg-gray-50 rounded-xl border border-gray-100 flex flex-col items-center justify-center transition-all">
                
                <!-- IMAGEN GRANDE DEL PARTIDO GANADOR -->
                <img id="winner-logo" 
                     src="" 
                     alt="" 
                     class="party-logo-main mb-4">
                
                <!-- Fallback por si fallan todas las im√°genes -->
                <div id="winner-fallback-icon" class="text-6xl mb-3 hidden" role="img" aria-label="Gr√°fico de resultados">üìä</div>
                
                <h3 id="winner-name" class="text-4xl font-black mt-2 tracking-tight">Partido</h3>
                <p id="winner-percent" class="text-gray-500 font-mono mt-2 text-sm uppercase tracking-wide">Puntos acumulados</p>
            </div>

            <div class="space-y-5" id="bars-container">
                <!-- Barras de resultados -->
            </div>

            <button id="restart-button" class="mt-10 w-full py-3 bg-slate-800 text-white rounded-lg hover:bg-slate-900 transition font-medium">
                Reiniciar Test
            </button>
        </div>

    </div>

    <script>
        // Encapsulaci√≥n en IIFE para evitar contaminar el scope global
        (function() {
            'use strict';

            // CONFIGURACI√ìN DE IM√ÅGENES (PNG)
            const partyData = {
                sumar: {
                    name: "SUMAR",
                    local: "SUMAR.png", 
                    online: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Sumar_logo.svg/320px-Sumar_logo.svg.png",
                    colorText: "text-sumar",
                    colorBg: "bg-sumar"
                },
                psoe: {
                    name: "PSOE",
                    local: "PSOE.png",
                    online: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Logotipo_del_PSOE.svg/320px-Logotipo_del_PSOE.svg.png",
                    colorText: "text-psoe",
                    colorBg: "bg-psoe"
                },
                pp: {
                    name: "PARTIDO POPULAR",
                    local: "PP.png",
                    online: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/87/Logo_PP_2019_azul.svg/320px-Logo_PP_2019_azul.svg.png",
                    colorText: "text-pp",
                    colorBg: "bg-pp"
                },
                vox: {
                    name: "VOX",
                    local: "VOX.png",
                    online: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Vox_logo.svg/320px-Vox_logo.svg.png",
                    colorText: "text-vox",
                    colorBg: "bg-vox"
                }
            };

            const questions = [
                // ECONOM√çA
                {
                    text: "Impuestos a las grandes fortunas:",
                    options: [
                        { text: "Incrementar significativamente para redistribuir riqueza.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Mantenerlos o aumentarlos moderadamente.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                        { text: "Reducir o eliminar para favorecer la inversi√≥n.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Eliminarlos completamente para incentivar la econom√≠a.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Vivienda y alquiler:",
                    options: [
                        { text: "Regulaci√≥n estricta de precios del alquiler.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Apoyo p√∫blico a vivienda social.", points: { sumar: 2, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Liberalizaci√≥n del mercado y reducci√≥n de trabas.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Libre mercado total, sin intervenci√≥n estatal.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Jornada laboral:",
                    options: [
                        { text: "Reducir a 32 horas semanales sin p√©rdida salarial.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Explorar reducci√≥n gradual si hay viabilidad.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                        { text: "Mantener 40 horas como referencia legal.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                        { text: "Flexibilizar horarios a favor de la productividad empresarial.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Salario m√≠nimo interprofesional (SMI):",
                    options: [
                        { text: "Subida acelerada hacia 1.500‚Ç¨/mes.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Incrementos progresivos seg√∫n econom√≠a.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Subidas controladas sin afectar la competitividad.", points: { sumar: 0, psoe: 1, pp: 3, vox: 1 } },
                        { text: "M√≠nima intervenci√≥n estatal en los salarios.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Empresas p√∫blicas vs. privadas:",
                    options: [
                        { text: "Reforzar y nacionalizar sectores estrat√©gicos.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Sector p√∫blico fuerte en servicios esenciales.", points: { sumar: 2, psoe: 3, pp: 0, vox: 0 } },
                        { text: "Privatizaci√≥n parcial para mejorar eficiencia.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Privatizaci√≥n total de servicios no esenciales.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                // SOCIAL
                {
                    text: "Aborto:",
                    options: [
                        { text: "Ampliar derechos y eliminar trabas.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Mantener legislaci√≥n actual con mejoras.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Limitar plazos o reforzar acompa√±amiento.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                        { text: "Restricci√≥n significativa o derogaci√≥n.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Eutanasia:",
                    options: [
                        { text: "Apoyo pleno y ampliaci√≥n de casos.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Mantener ley actual con garant√≠as m√©dicas.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Revisi√≥n para casos muy excepcionales.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                        { text: "Derogar la ley de eutanasia.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Matrimonio entre personas del mismo sexo:",
                    options: [
                        { text: "Apoyo incondicional y ampliaci√≥n de derechos LGTBI.", points: { sumar: 3, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Mantener legislaci√≥n actual sin retrocesos.", points: { sumar: 2, psoe: 2, pp: 3, vox: 0 } },
                        { text: "Reconocimiento con matices sobre adopci√≥n.", points: { sumar: 0, psoe: 0, pp: 2, vox: 1 } },
                        { text: "Revertir la legislaci√≥n vigente.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                    ]
                },
                {
                    text: "Identidad de g√©nero y menores:",
                    options: [
                        { text: "Libre autodeterminaci√≥n sin necesidad m√©dica.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Reconocimiento con acompa√±amiento profesional.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Restringir cambios legales hasta la mayor√≠a de edad.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Negar reconocimiento legal de identidad de g√©nero en menores.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Regulaci√≥n de la prostituci√≥n:",
                    options: [
                        { text: "Abolici√≥n total y penalizaci√≥n del cliente.", points: { sumar: 3, psoe: 2, pp: 0, vox: 1 } },
                        { text: "Persecuci√≥n de trata y apoyo a v√≠ctimas.", points: { sumar: 2, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Regulaci√≥n con controles sanitarios y laborales.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                        { text: "Libre ejercicio sin intervenci√≥n estatal.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                // EDUCACI√ìN
                {
                    text: "Ense√±anza de religi√≥n en escuelas p√∫blicas:",
                    options: [
                        { text: "Eliminar completamente de las aulas p√∫blicas.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Mantener como optativa sin peso curricular.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Conservar como oferta con m√°s valoraci√≥n.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Reforzar la formaci√≥n religiosa en el curr√≠culo.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Colegios concertados:",
                    options: [
                        { text: "Eliminar conciertos y reforzar solo la escuela p√∫blica.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Mantener conciertos con m√°s control y requisitos.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Respetar modelo dual con financiaci√≥n adecuada.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                        { text: "Expandir conciertos y fomentar libertad de elecci√≥n.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Lenguas cooficiales en la educaci√≥n:",
                    options: [
                        { text: "Inmersi√≥n ling√º√≠stica en lenguas auton√≥micas.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Modelo biling√ºe equilibrado y respeto a lo auton√≥mico.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Garantizar castellano como lengua vehicular mayoritaria.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Imponer castellano como √∫nica lengua vehicular.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Universidad p√∫blica y tasas:",
                    options: [
                        { text: "Gratuidad total de la educaci√≥n universitaria.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Reducci√≥n dr√°stica de tasas con becas accesibles.", points: { sumar: 2, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Tasas moderadas con becas seg√∫n m√©rito.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                        { text: "Tasas seg√∫n costes reales con sistema de pr√©stamos.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Contenido escolar sobre diversidad de g√©nero:",
                    options: [
                        { text: "Educaci√≥n afectivo-sexual inclusiva y obligatoria.", points: { sumar: 3, psoe: 3, pp: 0, vox: 0 } },
                        { text: "Formaci√≥n en igualdad y respeto a la diversidad.", points: { sumar: 2, psoe: 2, pp: 1, vox: 0 } },
                        { text: "Informar sin promover ideolog√≠as concretas.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                        { text: "Exclusi√≥n de contenidos sobre identidad de g√©nero.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                // TERRITORIAL
                {
                    text: "Independencia de Catalu√±a:",
                    options: [
                        { text: "Reconocer el derecho de autodeterminaci√≥n.", points: { sumar: 3, psoe: 0, pp: 0, vox: 0 } },
                        { text: "Di√°logo pol√≠tico dentro de la Constituci√≥n actual.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Defender la unidad sin ceder soberan√≠a.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                        { text: "Aplicar duramente la ley y reforzar el centralismo.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Reforma territorial del Estado:",
                    options: [
                        { text: "Avanzar hacia un modelo federal plurinacional.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Reforzar las autonom√≠as dentro del marco actual.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Mantener el modelo sin cambios de fondo.", points: { sumar: 0, psoe: 1, pp: 3, vox: 1 } },
                        { text: "Recentralizar competencias y reducir autonom√≠as.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Financiaci√≥n auton√≥mica:",
                    options: [
                        { text: "Modelo asim√©trico con cupos o singularidades.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Revisi√≥n del sistema garantizando equidad.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Financiaci√≥n centralizada desde el Estado.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Eliminaci√≥n de reg√≠menes forales especiales.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "S√≠mbolos oficiales del Estado:",
                    options: [
                        { text: "Aceptar s√≠mbolos regionales en instituciones auton√≥micas.", points: { sumar: 3, psoe: 2, pp: 1, vox: 0 } },
                        { text: "Convivencia de banderas con preeminencia del Estado.", points: { sumar: 1, psoe: 3, pp: 2, vox: 0 } },
                        { text: "Bandera de Espa√±a obligatoria en todos los actos oficiales.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                        { text: "Solo s√≠mbolos nacionales en todo el territorio espa√±ol.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Polic√≠a auton√≥mica (Mossos, Ertzaintza):",
                    options: [
                        { text: "Ampliar competencias policiales auton√≥micas.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Mantener modelo actual con coordinaci√≥n estatal.", points: { sumar: 1, psoe: 3, pp: 2, vox: 0 } },
                        { text: "Supervisi√≥n m√°s estrecha desde el Estado.", points: { sumar: 0, psoe: 1, pp: 3, vox: 1 } },
                        { text: "Centralizaci√≥n de todas las fuerzas de seguridad.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                // INMIGRACI√ìN
                {
                    text: "Regularizaci√≥n de inmigrantes sin papeles:",
                    options: [
                        { text: "Regularizaci√≥n amplia con derechos plenos.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Regularizaci√≥n con requisitos de integraci√≥n.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Solo casos excepcionales con arraigo demostrable.", points: { sumar: 0, psoe: 1, pp: 3, vox: 1 } },
                        { text: "Ninguna regularizaci√≥n, deportaciones reforzadas.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Control de fronteras:",
                    options: [
                        { text: "Priorizar acogida humanitaria y rutas seguras.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Combinar acogida con control ordenado.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Reforzar control para prevenir entrada irregular.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                        { text: "Cierre efectivo de fronteras y rechazo en frontera.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Derechos laborales de inmigrantes:",
                    options: [
                        { text: "Igualdad total de derechos laborales.", points: { sumar: 3, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Derechos garantizados con situaci√≥n regularizada.", points: { sumar: 1, psoe: 2, pp: 3, vox: 1 } },
                        { text: "Priorizar trabajadores nacionales en el acceso al empleo.", points: { sumar: 0, psoe: 0, pp: 2, vox: 3 } },
                        { text: "Restricci√≥n de acceso al mercado laboral para inmigrantes.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Reagrupaci√≥n familiar:",
                    options: [
                        { text: "Facilitar al m√°ximo la reagrupaci√≥n familiar.", points: { sumar: 3, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Permitir con condiciones de integraci√≥n.", points: { sumar: 1, psoe: 2, pp: 3, vox: 1 } },
                        { text: "Limitar a casos justificados con recursos probados.", points: { sumar: 0, psoe: 0, pp: 2, vox: 3 } },
                        { text: "Restringir dr√°sticamente la reagrupaci√≥n.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Ayudas sociales para inmigrantes:",
                    options: [
                        { text: "Acceso universal a ayudas sin distinci√≥n.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Acceso progresivo seg√∫n tiempo de residencia.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Solo para residentes legales con a√±os de cotizaci√≥n.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                        { text: "Prioridad absoluta para nacionales.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                // MEDIO AMBIENTE
                {
                    text: "Transici√≥n energ√©tica:",
                    options: [
                        { text: "Energ√≠as 100% renovables en plazos cortos.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Descarbonizaci√≥n progresiva hacia 2050.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Combinar renovables con gas y nuclear.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                        { text: "Priorizar competitividad econ√≥mica sobre medioambiente.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Agricultura y ganader√≠a industrial:",
                    options: [
                        { text: "Limitar macrogranjas y fomentar agricultura ecol√≥gica.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Promover sostenibilidad con apoyo al sector.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Apoyar la producci√≥n intensiva competitiva.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Eliminar trabas a la ganader√≠a industrial.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Uso del agua en la agricultura:",
                    options: [
                        { text: "Priorizar uso ecol√≥gico y limitar regad√≠os intensivos.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Gesti√≥n sostenible con modernizaci√≥n de regad√≠os.", points: { sumar: 1, psoe: 3, pp: 2, vox: 1 } },
                        { text: "Garantizar trasvases y disponibilidad para agricultores.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                        { text: "Libre uso agr√≠cola sin restricciones ambientales.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                {
                    text: "Energ√≠a nuclear:",
                    options: [
                        { text: "Cierre definitivo de todas las centrales.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                        { text: "Respetar el calendario de cierre pactado.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                        { text: "Extender la vida √∫til como energ√≠a de respaldo.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Energ√≠a estrat√©gica para la soberan√≠a energ√©tica.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                },
                // INTERNACIONAL
                {
                    text: "Uni√≥n Europea:",
                    options: [
                        { text: "Mayor integraci√≥n pol√≠tica, fiscal y social.", points: { sumar: 3, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Europa federal y refuerzo de instituciones.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Defensa de los intereses de Espa√±a dentro de la UE actual.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                        { text: "Priorizar soberan√≠a nacional frente a Bruselas.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                    ]
                },
                {
                    text: "Conflicto Israel - Palestina:",
                    options: [
                        { text: "Reconocimiento del Estado Palestino y exigencia de DDHH.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                        { text: "Soluci√≥n de dos Estados y apoyo a legalidad internacional.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                        { text: "Apoyo a Israel como democracia y derecho a defensa.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                        { text: "Alineamiento con Israel y lucha contra el terrorismo.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                    ]
                }
            ];

            let currentQuestion = 0;
            let scores = { sumar: 0, psoe: 0, pp: 0, vox: 0 };

            // Elementos del DOM
            const startScreen = document.getElementById('start-screen');
            const quizScreen = document.getElementById('quiz-screen');
            const resultScreen = document.getElementById('result-screen');
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');
            const progressBar = document.getElementById('progress-bar');
            const questionNumber = document.getElementById('question-number');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');

            // Event Listeners
            startButton.addEventListener('click', startQuiz);
            restartButton.addEventListener('click', () => window.location.reload());

            function startQuiz() {
                startScreen.classList.add('hidden');
                quizScreen.classList.remove('hidden');
                renderQuestion();
            }

            // Funci√≥n Fisher-Yates Shuffle para aleatorizar opciones
            function shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            // Manejador de errores para cargar im√°genes
            function handleImageError(imgElement) {
                const partyKey = imgElement.getAttribute('data-party');
                
                if (!partyKey || !partyData[partyKey]) {
                    // Si no hay partido, ocultar imagen
                    imgElement.style.display = 'none';
                    const fallback = document.getElementById('winner-fallback-icon');
                    if (fallback) {
                        fallback.classList.remove('hidden');
                    }
                    return;
                }

                const party = partyData[partyKey];
                
                // Si falla la local, intenta la online
                if (imgElement.src !== party.online) {
                    imgElement.src = party.online;
                } else {
                    // Si falla la online, muestra el icono fallback
                    imgElement.style.display = 'none';
                    const fallback = document.getElementById('winner-fallback-icon');
                    if (fallback) {
                        fallback.classList.remove('hidden');
                    }
                }
            }

            // Hacer la funci√≥n accesible globalmente para el atributo onerror
            window.handleImageError = handleImageError;

            function renderQuestion() {
                const q = questions[currentQuestion];
                if (!q) return;

                questionNumber.textContent = `PREGUNTA ${currentQuestion + 1}/${questions.length}`;
                questionText.textContent = q.text;
                
                // Actualizar barra de progreso - incluye la pregunta actual
                const percentage = ((currentQuestion + 1) / questions.length) * 100;
                progressBar.style.width = `${percentage}%`;
                progressBar.parentElement.setAttribute('aria-valuenow', percentage.toFixed(0));

                optionsContainer.innerHTML = '';
                
                // Animaci√≥n
                optionsContainer.classList.remove('slide-in');
                void optionsContainer.offsetWidth; 
                optionsContainer.classList.add('slide-in');

                const shuffledOptions = shuffleArray(q.options);

                shuffledOptions.forEach((opt, index) => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'btn-option w-full text-left p-4 rounded-lg border border-gray-200 hover:border-blue-500 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white text-gray-700 font-medium text-lg bg-white shadow-sm';
                    btn.textContent = opt.text;
                    btn.setAttribute('aria-label', `Opci√≥n ${index + 1}: ${opt.text}`);
                    btn.addEventListener('click', () => handleAnswer(opt.points));
                    optionsContainer.appendChild(btn);
                });
            }

            function handleAnswer(points) {
                // Sumar puntos
                Object.keys(points).forEach(party => {
                    scores[party] += points[party];
                });

                currentQuestion++;

                if (currentQuestion < questions.length) {
                    renderQuestion();
                } else {
                    showResult();
                }
            }

            function showResult() {
                quizScreen.classList.add('hidden');
                resultScreen.classList.remove('hidden');

                // Encontrar ganador - en caso de empate, toma el primero
                const sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
                const winnerKey = sortedScores[0][0];
                const winnerData = partyData[winnerKey];

                // Mostrar nombre del ganador
                const winnerEl = document.getElementById('winner-name');
                winnerEl.textContent = winnerData.name;
                winnerEl.className = `text-4xl font-black mt-2 tracking-tight ${winnerData.colorText}`;
                
                document.getElementById('winner-percent').textContent = `${scores[winnerKey]} Puntos acumulados`;

                // MOSTRAR IMAGEN GRANDE DEL GANADOR
                const logoImg = document.getElementById('winner-logo');
                logoImg.setAttribute('data-party', winnerKey);
                logoImg.setAttribute('alt', `Logo de ${winnerData.name}`);
                logoImg.src = winnerData.local; // Intenta cargar PNG local
                logoImg.classList.remove('hidden');
                logoImg.style.display = 'block';
                document.getElementById('winner-fallback-icon').classList.add('hidden');

                // Barras de progreso
                const barsContainer = document.getElementById('bars-container');
                const maxScore = sortedScores[0][1];

                barsContainer.innerHTML = ''; 

                sortedScores.forEach(([key, score]) => {
                    const pData = partyData[key];
                    const widthPercent = maxScore === 0 ? 0 : (score / maxScore) * 100;

                    const barDiv = document.createElement('div');
                    barDiv.className = 'mb-4';
                    barDiv.innerHTML = `
                        <div class="flex justify-between mb-1 items-center">
                            <div class="flex items-center gap-2">
                                <img src="${pData.local}" 
                                     alt="Logo de ${pData.name}"
                                     class="party-logo-small" 
                                     data-party="${key}"
                                     onerror="handleImageError(this)">
                                <span class="font-bold ${pData.colorText} text-sm md:text-base">
                                    ${pData.name}
                                </span>
                            </div>
                            <span class="text-gray-500 font-mono text-xs md:text-sm bg-gray-100 px-2 py-0.5 rounded">${score} pts</span>
                        </div>
                        <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                            <div class="${pData.colorBg} h-3 rounded-full transition-all duration-1000 ease-out" style="width: ${widthPercent}%"></div>
                        </div>
                    `;
                    barsContainer.appendChild(barDiv);
                });
            }
        })();
    </script>
</body>
</html>
