<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Afinidad Política España 2026</title>
    <meta name="description" content="Descubre tu afinidad con los principales partidos políticos de España.">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }

        /* Animaciones mejoradas */
        .slide-in {
            animation: slideIn 0.4s ease-out forwards;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .btn-option {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .btn-option:active {
            transform: scale(0.98);
        }

        /* Botón de abstención mejorado */
        .btn-abstention {
            background-color: #f1f5f9;
            color: #64748b;
            border: 1px solid #cbd5e1;
        }
        .btn-abstention:hover {
            background-color: #e2e8f0;
            color: #475569;
        }

        /* Barra de progreso mejorada */
        .progress-bar-container {
            height: 0.5rem;
            background-color: #e2e8f0;
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #2563eb);
            transition: width 0.3s ease;
        }

        /* Logos en resultados - MEJORADO */
        .party-logo {
            width: 48px;
            height: 48px;
            object-fit: contain;
            border-radius: 8px;
            background-color: #ffffff;
            padding: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .party-logo-small {
            width: 32px;
            height: 32px;
            object-fit: contain;
            border-radius: 4px;
        }

        /* Tarjeta de resultado mejorada */
        .result-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .result-card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        /* Barra de afinidad con gradiente */
        .affinity-bar {
            height: 24px;
            border-radius: 12px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .affinity-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Mejora de accesibilidad */
        .btn-option:focus, .btn-abstention:focus {
            outline: 3px solid #3b82f6;
            outline-offset: 2px;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .party-logo {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-3xl">
        <!-- Pantalla de inicio -->
        <div id="start-screen" class="bg-white rounded-2xl shadow-xl p-8 md:p-12 text-center slide-in">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">
                Test de Afinidad Política
            </h1>
            <p class="text-lg text-slate-600 mb-2">España 2026</p>
            <p class="text-slate-500 mb-8 max-w-xl mx-auto">
                Responde a las preguntas sobre temas actuales y descubre tu afinidad con los principales partidos políticos españoles.
            </p>
            <button 
                onclick="startTest()" 
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg text-lg transition-all hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300"
                aria-label="Comenzar test de afinidad política">
                Comenzar Test
            </button>
        </div>

        <!-- Pantalla de preguntas -->
        <div id="question-screen" class="bg-white rounded-2xl shadow-xl p-6 md:p-10 hidden">
            <!-- Barra de progreso -->
            <div class="mb-6">
                <div class="flex justify-between text-sm text-slate-600 mb-2">
                    <span>Pregunta <span id="current-question">1</span> de <span id="total-questions">20</span></span>
                    <span id="progress-percentage">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar-fill" style="width: 0%;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <!-- Pregunta -->
            <div class="mb-8">
                <h2 id="question-text" class="text-2xl md:text-3xl font-bold text-slate-800 mb-4"></h2>
            </div>

            <!-- Opciones de respuesta -->
            <div id="options-container" class="space-y-3 mb-6">
                <!-- Las opciones se generarán dinámicamente -->
            </div>
        </div>

        <!-- Pantalla de resultados -->
        <div id="results-screen" class="bg-white rounded-2xl shadow-xl p-6 md:p-10 hidden">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-800 mb-2 text-center">Tus Resultados</h2>
            <p class="text-slate-600 text-center mb-8">Afinidad con partidos políticos españoles</p>

            <div id="results-container" class="space-y-4"></div>

            <div class="mt-8 text-center">
                <button 
                    onclick="location.reload()" 
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg transition-all hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300"
                    aria-label="Reiniciar test">
                    Reiniciar Test
                </button>
            </div>

            <div class="mt-8 text-xs text-slate-500 text-center">
                <p>Este test es orientativo y se basa en las posiciones generales de los partidos. Los resultados no representan una recomendación de voto.</p>
            </div>
        </div>
    </div>

    <script>

        // --- DATOS DEL TEST ---
        const parties = {
            sumar: { name: "Sumar / Izquierda", colorBg: "bg-pink-600", colorText: "text-pink-600" },
            psoe:  { name: "PSOE", colorBg: "bg-red-600", colorText: "text-red-600" },
            pp:    { name: "Partido Popular", colorBg: "bg-blue-600", colorText: "text-blue-600" },
            vox:   { name: "VOX", colorBg: "bg-green-600", colorText: "text-green-600" }
        };

        const questions = [
            // --- ECONOMÍA ---
            {
                text: "Impuestos a las grandes fortunas:",
                options: [
                    { text: "Incrementar significativamente para redistribuir riqueza.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Mantenerlos o aumentarlos moderadamente.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Reducir o eliminar para favorecer la inversión.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Eliminarlos completamente para incentivar la economía.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Vivienda y alquiler:",
                options: [
                    { text: "Regulación estricta de precios del alquiler.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Apoyo público a vivienda social.", points: { sumar: 2, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Liberalización del mercado y reducción de trabas.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Libre mercado total, sin intervención estatal.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Jornada laboral:",
                options: [
                    { text: "Reducir a 32 horas semanales sin pérdida salarial.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Explorar reducción gradual si hay viabilidad.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Mantener 40 horas como referencia legal.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Flexibilizar horarios a favor de la empresa.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Salario Mínimo (SMI):",
                options: [
                    { text: "Subida acelerada hacia 1.500€/mes.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Incrementos progresivos según la economía.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Subidas muy moderadas para no afectar competitividad.", points: { sumar: 0, psoe: 1, pp: 3, vox: 1 } },
                    { text: "Mínima intervención estatal en los salarios.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Sistema de pensiones:",
                options: [
                    { text: "Reforzar pensiones públicas con impuestos.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Mantener sistema público con ajustes sostenibles.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Fomentar planes privados complementarios.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Transición hacia sistema mixto o privado.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // --- SOCIAL ---
            {
                text: "Aborto:",
                options: [
                    { text: "Ampliar derechos y garantizarlo en la pública.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Mantener legislación actual.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Limitar plazos o reforzar 'acompañamiento'.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Restricción significativa o derogación.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Eutanasia:",
                options: [
                    { text: "Apoyo pleno y ampliación de supuestos.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Mantener ley actual con garantías.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Revisión para casos muy excepcionales.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Derogar la ley de eutanasia.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Matrimonio Igualitario (LGTBI):",
                options: [
                    { text: "Blindaje total y ampliación de derechos.", points: { sumar: 3, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Mantener el matrimonio igualitario vigente.", points: { sumar: 2, psoe: 2, pp: 3, vox: 0 } },
                    { text: "Unión civil, pero reservar nombre 'matrimonio'.", points: { sumar: 0, psoe: 0, pp: 2, vox: 1 } },
                    { text: "Revertir la legislación sobre matrimonio gay.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                ]
            },
            {
                text: "Identidad de género (Ley Trans):",
                options: [
                    { text: "Libre autodeterminación sin tutelas.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Reconocimiento con cierto acompañamiento.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Restringir cambios legales en menores.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Negar concepto de identidad de género.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Violencia de género:",
                options: [
                    { text: "Más recursos y enfoque feminista transversal.", points: { sumar: 3, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Mantener Ley actual y Pacto de Estado.", points: { sumar: 2, psoe: 2, pp: 2, vox: 0 } },
                    { text: "Hablar de 'violencia intrafamiliar' sin género.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Eliminar leyes específicas de género.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                ]
            },
            {
                text: "Memoria Democrática:",
                options: [
                    { text: "Justicia, verdad y reparación total.", points: { sumar: 3, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Mantener Ley de Memoria actual.", points: { sumar: 2, psoe: 2, pp: 1, vox: 0 } },
                    { text: "Cerrar heridas y no remover el pasado.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Derogar leyes de memoria histórica.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // --- EDUCACIÓN ---
            {
                text: "Religión en las escuelas:",
                options: [
                    { text: "Fuera de la escuela pública.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Optativa sin valor académico.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Materia evaluable y con peso.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Eje central de la formación moral.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Escuela Concertada:",
                options: [
                    { text: "Eliminar conciertos progresivamente.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Mantener pero con más control de admisión.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Blindar y proteger la libertad de elección.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                    { text: "Fomentar cheque escolar universal.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Inmersión Lingüística:",
                options: [
                    { text: "Proteger inmersión en lenguas cooficiales.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Equilibrio respetando la realidad autonómica.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Garantizar 25%-50% en castellano por ley.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Castellano única lengua vehicular.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Universidad y Tasas:",
                options: [
                    { text: "Gratuidad total universitaria.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Reducción de tasas y más becas.", points: { sumar: 2, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Tasas moderadas y becas al mérito.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                    { text: "Sistema de préstamos o coste real.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // --- TERRITORIAL ---
            {
                text: "Modelo de Estado:",
                options: [
                    { text: "República Federal Plurinacional.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Estado de las Autonomías reforzado.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Status quo actual (Constitución 78).", points: { sumar: 0, psoe: 1, pp: 3, vox: 1 } },
                    { text: "Estado unitario y recentralización.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Financiación Autonómica:",
                options: [
                    { text: "Reconocer singularidad fiscal (tipo cupo).", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Reforma federalizante pero solidaria.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Régimen común igual para todos.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Eliminar cupos forales existentes.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Jefatura del Estado:",
                options: [
                    { text: "Referéndum Monarquía/República.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Debate sobre modernización institucional.", points: { sumar: 2, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Apoyo a la Monarquía Parlamentaria.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                    { text: "Defensa férrea del Rey.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // --- INMIGRACIÓN ---
            {
                text: "Inmigración irregular:",
                options: [
                    { text: "Regularización amplia y derechos humanos.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Regularización vinculada al empleo.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Control estricto de fronteras.", points: { sumar: 0, psoe: 1, pp: 3, vox: 1 } },
                    { text: "Deportaciones masivas y cierre fronterizo.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // --- ECOLOGÍA ---
            {
                text: "Transición Ecológica:",
                options: [
                    { text: "Acelerada y ambiciosa (Green New Deal).", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Cumplimiento de Agenda 2030 progresivo.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Mix energético pragmático (sin prisas).", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                    { text: "Rechazo al 'fanatismo climático'.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Energía Nuclear:",
                options: [
                    { text: "Cierre definitivo y rápido.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Cierre programado según calendario.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Alargar vida útil de centrales.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Construir nuevas centrales.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // --- INTERNACIONAL ---
            {
                text: "Integración Europea:",
                options: [
                    { text: "Estados Unidos de Europa (Federalismo).", points: { sumar: 3, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Más integración política y fiscal.", points: { sumar: 2, psoe: 2, pp: 1, vox: 0 } },
                    { text: "Europa de las Naciones (Soberanía).", points: { sumar: 0, psoe: 1, pp: 3, vox: 1 } },
                    { text: "Recuperar competencias de Bruselas.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                ]
            },
            {
                text: "Defensa Europea (Ejército):",
                options: [
                    { text: "Crear Ejército Europeo y autonomía de la OTAN.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Defensa europea complementaria a la OTAN.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "La OTAN es la única garantía real.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                    { text: "Defensa nacional soberana, no supranacional.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Palestina - Israel:",
                options: [
                    { text: "Reconocer Estado Palestino y sanciones a Israel.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Solución dos Estados y diplomacia.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Apoyo al derecho de defensa de Israel.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Alineamiento total con Israel.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Guerra en Ucrania:",
                options: [
                    { text: "Apoyo humanitario, pero no militar ofensivo.", points: { sumar: 3, psoe: 2, pp: 1, vox: 2 } }, // Matiz pacifista izq
                    { text: "Apoyo militar firme a Ucrania.", points: { sumar: 1, psoe: 3, pp: 3, vox: 1 } }, // Bloque central pro-OTAN
                    { text: "Presionar para negociar paz cediendo territorio.", points: { sumar: 2, psoe: 1, pp: 1, vox: 2 } },
                    { text: "No intervención / Neutralidad estricta.", points: { sumar: 1, psoe: 0, pp: 0, vox: 3 } }
                ]
            },
            {
                text: "Política Exterior y EE.UU.:",
                options: [
                    { text: "Autonomía estratégica frente a EE.UU.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Socio preferente pero con voz propia.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Reforzar vínculo atlántico al máximo.", points: { sumar: 0, psoe: 1, pp: 3, vox: 2 } },
                    { text: "Alineamiento total con la política de EE.UU.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            }
        ];

        // --- LÓGICA DEL TEST ---
        let currentQuestionIndex = 0;
        let scores = { sumar: 0, psoe: 0, pp: 0, vox: 0 };
        // Máximos teóricos para calcular porcentajes (aproximado, se recalcula dinámicamente si se quiere exactitud total)
        // Para simplificar, comparamos raw scores al final.

        function startTest() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('progress-section').style.display = 'block';
            document.getElementById('question-screen').classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }

            const q = questions[currentQuestionIndex];
            
            // Actualizar textos
            const qTextEl = document.getElementById('question-text');
            qTextEl.innerText = q.text;
            qTextEl.classList.remove('slide-in');
            void qTextEl.offsetWidth; // Trigger reflow
            qTextEl.classList.add('slide-in');

            // Generar opciones
            const container = document.getElementById('options-container');
            container.innerHTML = ''; // Limpiar

            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'btn-option w-full text-left p-4 rounded-lg border border-slate-200 hover:border-blue-300 hover:bg-blue-50 bg-white text-slate-700 font-medium text-sm md:text-base mb-2 shadow-sm';
                btn.innerText = opt.text;
                btn.onclick = () => handleAnswer(opt.points);
                
                // Animación escalonada
                btn.style.opacity = '0';
                btn.style.animation = `slideIn 0.3s ease-out forwards ${idx * 0.1}s`;
                
                container.appendChild(btn);
            });

            // Actualizar barra
            updateProgress();
        }

        function handleAnswer(points) {
            if (points) {
                for (let party in points) {
                    if (scores.hasOwnProperty(party)) {
                        scores[party] += points[party];
                    }
                }
            }
            // Si points es null, es abstención (no suma nada)

            currentQuestionIndex++;
            loadQuestion();
        }

        function updateProgress() {
            const pct = Math.round((currentQuestionIndex / questions.length) * 100);
            document.getElementById('progress-fill').style.width = `${pct}%`;
            document.getElementById('progress-percentage').innerText = `${pct}%`;
            document.getElementById('progress-text').innerText = `Pregunta ${currentQuestionIndex + 1} de ${questions.length}`;
        }

        function showResults() {
            document.getElementById('question-screen').classList.add('hidden');
            document.getElementById('progress-section').style.display = 'none';
            document.getElementById('results-screen').classList.remove('hidden');

            const barsContainer = document.getElementById('results-bars');
            
            // Convertir objeto scores a array y ordenar
            const sortedParties = Object.keys(scores).sort((a, b) => scores[b] - scores[a]);
            
            // Encontrar puntuación máxima para normalizar barras
            const maxScore = Math.max(...Object.values(scores));

            sortedParties.forEach(key => {
                const score = scores[key];
                const pData = parties[key];
                
                // Evitar división por cero
                const widthPercent = maxScore > 0 ? (score / maxScore) * 100 : 0;

                const barDiv = document.createElement('div');
                barDiv.className = 'mb-4';
                barDiv.innerHTML = `
                    <div class="flex justify-between mb-1 items-center">
                        <span class="font-bold ${pData.colorText} text-sm md:text-base">${pData.name}</span>
                        <span class="text-slate-500 font-mono text-xs bg-slate-100 px-2 py-0.5 rounded">${score} pts</span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-3 overflow-hidden">
                        <div class="${pData.colorBg} h-3 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
                    </div>
                `;
                barsContainer.appendChild(barDiv);

                // Animar la barra después de un breve delay
                setTimeout(() => {
                    barDiv.querySelector('div[class*="h-3 rounded-full"]').style.width = `${widthPercent}%`;
                }, 100);
            });
        }
    

        // MODIFICACIÓN: Añadir información de logos a los partidos
        const partyLogos = {
            sumar: "sumar.png",
            psoe: "psoe.png",
            pp: "pp.png",
            vox: "vox.png"
        };

        // Modificar la función showResults para incluir los logos
        const originalShowResults = showResults;
        showResults = function() {
            originalShowResults();

            // Añadir logos después de que se generen los resultados
            setTimeout(() => {
                const resultCards = document.querySelectorAll('[data-party]');
                resultCards.forEach(card => {
                    const partyKey = card.getAttribute('data-party');
                    const logo = partyLogos[partyKey];

                    if (logo) {
                        const nameElement = card.querySelector('.font-bold');
                        if (nameElement) {
                            const logoImg = document.createElement('img');
                            logoImg.src = logo;
                            logoImg.alt = `Logo de ${parties[partyKey].name}`;
                            logoImg.className = 'party-logo';
                            logoImg.loading = 'lazy';
                            logoImg.onerror = function() { this.style.display = 'none'; };

                            // Crear contenedor flex para logo + nombre
                            const container = document.createElement('div');
                            container.className = 'flex items-center gap-3';

                            const parent = nameElement.parentElement;
                            parent.insertBefore(container, nameElement);
                            container.appendChild(logoImg);
                            container.appendChild(nameElement);
                        }
                    }
                });
            }, 100);
        };
    </script>
</body>
</html>