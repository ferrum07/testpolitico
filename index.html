<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Afinidad Pol√≠tica Espa√±a</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        
        /* Estilos de transici√≥n */
        .slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-option {
            transition: all 0.2s;
        }
        .btn-option:active {
            transform: scale(0.99);
        }

        /* Colores Espec√≠ficos */
        .bg-sumar { background-color: #E51C55; }
        .text-sumar { color: #E51C55; }
        
        .bg-psoe { background-color: #E30613; }
        .text-psoe { color: #E30613; }
        
        .bg-pp { background-color: #0056A3; }
        .text-pp { color: #0056A3; }
        
        .bg-vox { background-color: #63BE21; }
        .text-vox { color: #63BE21; }

        /* Estilos de Im√°genes */
        .party-logo-main {
            height: 160px; /* Tama√±o grande para el resultado final */
            width: auto;
            object-fit: contain;
            display: block;
            margin: 0 auto;
        }
        .party-logo-small {
            height: 24px;
            width: 24px;
            object-fit: contain;
            margin-right: 8px;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Contenedor Principal -->
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden min-h-[600px] flex flex-col relative border border-gray-100">
        
        <!-- Header -->
        <div class="bg-slate-800 text-white p-6 text-center shadow-md">
            <h1 class="text-2xl font-bold tracking-tight">Br√∫jula Electoral</h1>
            <p class="text-slate-300 text-sm mt-1">An√°lisis de posicionamiento pol√≠tico en 30 cuestiones</p>
        </div>

        <!-- Pantalla de Inicio -->
        <div id="start-screen" class="flex-1 flex flex-col items-center justify-center p-8 text-center space-y-6">
            <div class="text-6xl mb-2">üó≥Ô∏è</div>
            <h2 class="text-xl font-semibold text-gray-800">Test de Afinidad Pol√≠tica</h2>
            <p class="text-gray-600 max-w-md">Este cuestionario compara tus respuestas con los programas electorales oficiales de los principales partidos.</p>
            
            <div class="text-xs text-gray-500 bg-gray-50 p-3 rounded border border-gray-200">
                <strong>Nota:</strong> Las opciones se presentan desordenadas aleatoriamente.
            </div>

            <button onclick="startQuiz()" class="px-8 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                Iniciar Cuestionario
            </button>
        </div>

        <!-- Pantalla de Preguntas -->
        <div id="quiz-screen" class="hidden flex-1 flex flex-col p-6">
            <!-- Barra de progreso -->
            <div class="w-full bg-gray-100 rounded-full h-2 mb-8">
                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            
            <div class="flex-1 flex flex-col justify-center">
                <div class="mb-4">
                    <span id="question-number" class="text-xs font-bold text-blue-600 uppercase tracking-wider bg-blue-50 px-2 py-1 rounded">Pregunta 1/30</span>
                </div>
                
                <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-snug">
                    <!-- Pregunta insertada por JS -->
                </h2>

                <div id="options-container" class="space-y-3">
                    <!-- Opciones insertadas por JS -->
                </div>
            </div>
        </div>

        <!-- Pantalla de Resultados -->
        <div id="result-screen" class="hidden flex-1 flex flex-col p-6 slide-in overflow-y-auto max-h-[90vh]">
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-2">An√°lisis de Resultados</h2>
            <p class="text-center text-gray-500 mb-6 text-sm">Tu mayor afinidad es con:</p>

            <!-- Contenedor del Ganador -->
            <div id="winner-container" class="text-center mb-8 p-8 bg-gray-50 rounded-xl border border-gray-100 flex flex-col items-center justify-center transition-all">
                
                <!-- IMAGEN GRANDE DEL PARTIDO GANADOR -->
                <img id="winner-logo" 
                     src="" 
                     alt="Logo Partido" 
                     class="party-logo-main mb-4" 
                     onerror="handleImageError(this)">
                
                <!-- Fallback por si fallan todas las im√°genes -->
                <div id="winner-fallback-icon" class="text-6xl mb-3 hidden">üìä</div>
                
                <h3 id="winner-name" class="text-4xl font-black mt-2 tracking-tight">Partido</h3>
                <p id="winner-percent" class="text-gray-500 font-mono mt-2 text-sm uppercase tracking-wide">Puntos acumulados</p>
            </div>

            <div class="space-y-5" id="bars-container">
                <!-- Barras de resultados -->
            </div>

            <button onclick="location.reload()" class="mt-10 w-full py-3 bg-slate-800 text-white rounded-lg hover:bg-slate-900 transition font-medium">
                Reiniciar Test
            </button>
        </div>

    </div>

    <script>
        // CONFIGURACI√ìN DE IM√ÅGENES (PNG)
        const partyData = {
            sumar: {
                name: "SUMAR",
                local: "SUMAR.png", 
                online: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Sumar_logo.svg/320px-Sumar_logo.svg.png",
                colorText: "text-sumar",
                colorBg: "bg-sumar"
            },
            psoe: {
                name: "PSOE",
                local: "PSOE.png",
                online: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Logotipo_del_PSOE.svg/320px-Logotipo_del_PSOE.svg.png",
                colorText: "text-psoe",
                colorBg: "bg-psoe"
            },
            pp: {
                name: "PARTIDO POPULAR",
                local: "PP.png",
                online: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/87/Logo_PP_2019_azul.svg/320px-Logo_PP_2019_azul.svg.png",
                colorText: "text-pp",
                colorBg: "bg-pp"
            },
            vox: {
                name: "VOX",
                local: "VOX.png",
                online: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Vox_logo.svg/320px-Vox_logo.svg.png",
                colorText: "text-vox",
                colorBg: "bg-vox"
            }
        };

        // --- PREGUNTAS (Versi√≥n Neutral) ---
        const questions = [
            // ECONOM√çA
            {
                text: "Pol√≠tica fiscal e impuestos a grandes patrimonios y banca:",
                options: [
                    { text: "Deben ser permanentes y progresivos para financiar el Estado del Bienestar.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Son necesarios coyunturalmente, pero deben evaluarse seg√∫n la situaci√≥n.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Deben reducirse o eliminarse para fomentar la inversi√≥n y el crecimiento.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Bajada generalizada de impuestos para reducir la carga fiscal sobre las familias.", points: { sumar: 0, psoe: 0, pp: 2, vox: 3 } }
                ]
            },
            {
                text: "Salario M√≠nimo Interprofesional (SMI):",
                options: [
                    { text: "Debe seguir aumentando por ley hasta alcanzar el 60% del salario medio.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Debe actualizarse buscando siempre el consenso en el di√°logo social.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Su subida debe ser prudente para no afectar a la contrataci√≥n en pymes.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "El Estado no deber√≠a intervenir los salarios, es competencia del mercado.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Sistema de Pensiones y Jubilaci√≥n:",
                options: [
                    { text: "Revalorizaci√≥n autom√°tica con el IPC y blindaje constitucional.", points: { sumar: 2, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Permitir la jubilaci√≥n anticipada en trabajos penosos sin penalizaci√≥n.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Garantizar la sostenibilidad priorizando la jubilaci√≥n activa.", points: { sumar: 0, psoe: 1, pp: 3, vox: 0 } },
                    { text: "Reducir el gasto p√∫blico estructural y fomentar el ahorro privado.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Jornada Laboral:",
                options: [
                    { text: "Reducci√≥n legal de la jornada m√°xima sin reducci√≥n salarial.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Avanzar hacia la reducci√≥n mediante negociaci√≥n colectiva.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Flexibilidad horaria acordada entre empresa y trabajador.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "La prioridad debe ser mejorar la productividad, no reducir horas por ley.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // SERVICIOS P√öBLICOS
            {
                text: "Gesti√≥n de la Sanidad P√∫blica:",
                options: [
                    { text: "Gesti√≥n exclusivamente p√∫blica y reversi√≥n de externalizaciones.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Reforzar el sistema p√∫blico como pilar fundamental.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Colaboraci√≥n p√∫blico-privada para mejorar la eficiencia.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Unificaci√≥n de la tarjeta sanitaria y recentralizaci√≥n.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Educaci√≥n Concertada:",
                options: [
                    { text: "Priorizar la educaci√≥n p√∫blica y reducir progresivamente los conciertos.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Mantener el sistema actual garantizando la equidad.", points: { sumar: 0, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Blindar la libertad de elecci√≥n de centro de los padres.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Implantar el cheque escolar para garantizar la libre elecci√≥n real.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Ley de Vivienda:",
                options: [
                    { text: "Regulaci√≥n de precios obligatoria en zonas tensionadas.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Incentivos fiscales a propietarios que bajen el alquiler y m√°s vivienda p√∫blica.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Aumentar la oferta liberando suelo y dando seguridad jur√≠dica.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Derogaci√≥n de la Ley de Vivienda actual por ser intervencionista.", points: { sumar: 0, psoe: 0, pp: 2, vox: 3 } }
                ]
            },
            // SOCIAL
            {
                text: "Ley Trans y derechos LGTBI:",
                options: [
                    { text: "Defensa plena de la autodeterminaci√≥n de g√©nero.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Mantener la legislaci√≥n vigente que garantiza derechos civiles.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Revisar la ley para garantizar seguridad jur√≠dica y protecci√≥n del menor.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Derogaci√≥n de leyes que consideren contrarias a la biolog√≠a.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                ]
            },
            {
                text: "Violencia de G√©nero:",
                options: [
                    { text: "Es una violencia estructural que requiere pol√≠ticas espec√≠ficas.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Reforzar el Pacto de Estado y la protecci√≥n a las v√≠ctimas.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Combatir toda violencia dom√©stica, manteniendo protecci√≥n espec√≠fica.", points: { sumar: 0, psoe: 0, pp: 3, vox: 0 } },
                    { text: "Ley de Violencia Intrafamiliar que trate a todas las v√≠ctimas por igual.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Aborto:",
                options: [
                    { text: "Garantizarlo en la red p√∫blica sin periodos de reflexi√≥n obligatorios.", points: { sumar: 3, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Mantener la ley de plazos actual.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Apoyo a la maternidad y fomento de alternativas.", points: { sumar: 0, psoe: 0, pp: 2, vox: 2 } },
                    { text: "Defensa de la vida desde la concepci√≥n.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Memoria Democr√°tica:",
                options: [
                    { text: "Profundizar en la reparaci√≥n de las v√≠ctimas y retirar simbolog√≠a.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Cumplimiento de la ley actual para cerrar heridas.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Centrarse en la concordia y no utilizar la historia pol√≠ticamente.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Derogaci√≥n de la Ley de Memoria Democr√°tica.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Eutanasia:",
                options: [
                    { text: "Es un derecho civil consolidado que debe garantizarse.", points: { sumar: 3, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Mantener la regulaci√≥n actual con sus garant√≠as.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Priorizar una Ley de Cuidados Paliativos integral.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Defensa de la vida hasta su t√©rmino natural.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                ]
            },
            // TERRITORIAL
            {
                text: "Modelo Territorial:",
                options: [
                    { text: "Reconocimiento de la plurinacionalidad y di√°logo pol√≠tico.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Convivencia dentro del marco constitucional.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Defensa del Estado de las Autonom√≠as y la igualdad.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Recuperaci√≥n de competencias por parte del Estado central.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                ]
            },
            {
                text: "Jefatura del Estado:",
                options: [
                    { text: "Aspiraci√≥n hacia un modelo republicano.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Respeto al pacto constitucional sobre la Monarqu√≠a.", points: { sumar: 1, psoe: 3, pp: 2, vox: 0 } },
                    { text: "Defensa de la Monarqu√≠a como garante de estabilidad.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "La Corona es s√≠mbolo fundamental de la unidad de Espa√±a.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // INMIGRACI√ìN
            {
                text: "Gesti√≥n de la Inmigraci√≥n:",
                options: [
                    { text: "V√≠as legales y seguras, con enfoque en derechos humanos.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Equilibrio entre control de fronteras y cooperaci√≥n.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Inmigraci√≥n legal vinculada al mercado laboral.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Prioridad nacional y endurecimiento de requisitos.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                ]
            },
            {
                text: "Ocupaci√≥n de Viviendas:",
                options: [
                    { text: "Distingir entre vulnerables y mafias. Proteger vulnerables.", points: { sumar: 3, psoe: 1, pp: 0, vox: 0 } },
                    { text: "Agilizar los procesos judiciales.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Desalojo expr√©s en 24 horas y endurecimiento de penas.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Tolerancia cero y defensa absoluta de la propiedad.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // ENERG√çA
            {
                text: "Transici√≥n Energ√©tica:",
                options: [
                    { text: "Acelerar la descarbonizaci√≥n y aumentar ambici√≥n clim√°tica.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Transici√≥n justa, apostando por renovables.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Compromiso medioambiental compatible con crecimiento econ√≥mico.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Rechazo a imposiciones clim√°ticas que perjudiquen al sector primario.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            {
                text: "Energ√≠a Nuclear:",
                options: [
                    { text: "Cierre programado y apuesta por renovables.", points: { sumar: 3, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Respetar el calendario de cierre pactado.", points: { sumar: 1, psoe: 3, pp: 0, vox: 0 } },
                    { text: "Extender la vida √∫til como energ√≠a de respaldo.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Energ√≠a estrat√©gica para la soberan√≠a energ√©tica.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            },
            // INTERNACIONAL
            {
                text: "Uni√≥n Europea:",
                options: [
                    { text: "Mayor integraci√≥n pol√≠tica, fiscal y social.", points: { sumar: 3, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Europa federal y refuerzo de instituciones.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Defensa de los intereses de Espa√±a dentro de la UE actual.", points: { sumar: 0, psoe: 0, pp: 3, vox: 1 } },
                    { text: "Priorizar soberan√≠a nacional frente a Bruselas.", points: { sumar: 0, psoe: 0, pp: 0, vox: 3 } }
                ]
            },
            {
                text: "Conflicto Israel - Palestina:",
                options: [
                    { text: "Reconocimiento del Estado Palestino y exigencia de DDHH.", points: { sumar: 3, psoe: 2, pp: 0, vox: 0 } },
                    { text: "Soluci√≥n de dos Estados y apoyo a legalidad internacional.", points: { sumar: 1, psoe: 3, pp: 1, vox: 0 } },
                    { text: "Apoyo a Israel como democracia y derecho a defensa.", points: { sumar: 0, psoe: 0, pp: 3, vox: 2 } },
                    { text: "Alineamiento con Israel y lucha contra el terrorismo.", points: { sumar: 0, psoe: 0, pp: 1, vox: 3 } }
                ]
            }
        ];

        let currentQuestion = 0;
        let scores = { sumar: 0, psoe: 0, pp: 0, vox: 0 };

        function startQuiz() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            renderQuestion();
        }

        // Funci√≥n Fisher-Yates Shuffle para aleatorizar opciones
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Manejador de errores para cargar im√°genes
        // Intenta cargar la imagen local, si falla carga la online.
        function handleImageError(imgElement) {
            let partyKey = null;
            
            // Intentar detectar partido por SRC o atributo
            if (!partyKey) partyKey = imgElement.getAttribute('data-party');

            // Si no tiene atributo data-party, buscar en las claves
            if (!partyKey) {
                for (const key in partyData) {
                    if (imgElement.src.includes(partyData[key].local)) {
                        partyKey = key;
                        break;
                    }
                }
            }

            if (partyKey && imgElement.src !== partyData[partyKey].online) {
                // Si falla la local, intenta la online
                imgElement.src = partyData[partyKey].online;
            } else {
                // Si falla la online, muestra el icono fallback
                imgElement.style.display = 'none';
                document.getElementById('winner-fallback-icon').classList.remove('hidden');
                document.getElementById('winner-fallback-icon').style.display = 'block';
            }
        }

        function renderQuestion() {
            const q = questions[currentQuestion];
            document.getElementById('question-number').innerText = `PREGUNTA ${currentQuestion + 1}/${questions.length}`;
            document.getElementById('question-text').innerText = q.text;
            
            const percentage = ((currentQuestion) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${percentage}%`;

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            container.classList.remove('slide-in');
            void container.offsetWidth; 
            container.classList.add('slide-in');

            const shuffledOptions = shuffleArray([...q.options]);

            shuffledOptions.forEach((opt) => {
                const btn = document.createElement('button');
                btn.className = 'btn-option w-full text-left p-4 rounded-lg border border-gray-200 hover:border-blue-500 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white text-gray-700 font-medium text-lg bg-white shadow-sm';
                btn.innerText = opt.text;
                btn.onclick = () => handleAnswer(opt.points);
                container.appendChild(btn);
            });
        }

        function handleAnswer(points) {
            scores.sumar += points.sumar;
            scores.psoe += points.psoe;
            scores.pp += points.pp;
            scores.vox += points.vox;

            currentQuestion++;

            if (currentQuestion < questions.length) {
                renderQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');

            const winnerKey = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            const winnerData = partyData[winnerKey];

            // Mostrar nombre del ganador
            const winnerEl = document.getElementById('winner-name');
            winnerEl.innerText = winnerData.name;
            winnerEl.className = `text-4xl font-black mt-2 tracking-tight ${winnerData.colorText}`;
            
            document.getElementById('winner-percent').innerText = `${scores[winnerKey]} Puntos acumulados`;

            // MOSTRAR IMAGEN GRANDE DEL GANADOR
            const logoImg = document.getElementById('winner-logo');
            logoImg.setAttribute('data-party', winnerKey); 
            logoImg.src = winnerData.local; // Intenta cargar PNG local
            logoImg.classList.remove('hidden');
            document.getElementById('winner-fallback-icon').classList.add('hidden');

            // Barras de progreso
            const barsContainer = document.getElementById('bars-container');
            const sortedKeys = Object.keys(scores).sort((a, b) => scores[b] - scores[a]);
            const maxScore = scores[winnerKey];

            barsContainer.innerHTML = ''; 

            sortedKeys.forEach(key => {
                const score = scores[key];
                const pData = partyData[key];
                const widthPercent = maxScore === 0 ? 0 : (score / maxScore) * 100;

                const html = `
                    <div class="mb-4">
                        <div class="flex justify-between mb-1 items-center">
                            <div class="flex items-center gap-2">
                                <!-- Logo peque√±o en la barra -->
                                <img src="${pData.local}" 
                                     class="party-logo-small" 
                                     data-party="${key}"
                                     onerror="handleImageError(this)">
                                <span class="font-bold ${pData.colorText} text-sm md:text-base">
                                    ${pData.name}
                                </span>
                            </div>
                            <span class="text-gray-500 font-mono text-xs md:text-sm bg-gray-100 px-2 py-0.5 rounded">${score} pts</span>
                        </div>
                        <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                            <div class="${pData.colorBg} h-3 rounded-full transition-all duration-1000 ease-out" style="width: ${widthPercent}%"></div>
                        </div>
                    </div>
                `;
                barsContainer.innerHTML += html;
            });
        }
    </script>
</body>
</html>
